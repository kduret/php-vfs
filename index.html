<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>PHP Virtual filesystem by thornag</title>
  </head>

  <body>
    <a href="https://github.com/thornag/php-vfs"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
    <div id="container">
      <div class="inner">

        <header>
          <h1>PHP Virtual filesystem</h1>
          <h2>php-vfs - unit testing filesystem methods made easy!</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/thornag/php-vfs/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/thornag/php-vfs/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/thornag/php-vfs" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <table>
<thead><tr>
<th align="center">Build status</th>
<th align="center">Coverage</th>
<th align="center">Last stable</th>
<th align="center">Last development</th>
</tr></thead>
<tbody><tr>
<td align="center"><a href="https://travis-ci.org/thornag/php-vfs"><img src="https://travis-ci.org/thornag/php-vfs.png" alt="Build Status"></a></td>
<td align="center"><a href="https://coveralls.io/r/thornag/php-vfs?branch=master"><img src="https://coveralls.io/repos/thornag/php-vfs/badge.png?branch=master" alt="Coverage Status"></a></td>
<td align="center"><a href="https://packagist.org/packages/php-vfs/php-vfs"><img src="https://poser.pugx.org/php-vfs/php-vfs/v/stable.png" alt="Latest Stable Version"></a></td>
<td align="center"><a href="https://packagist.org/packages/php-vfs/php-vfs"><img src="https://poser.pugx.org/php-vfs/php-vfs/v/unstable.png" alt="Latest Unstable Version"></a></td>
</tr></tbody>
</table><h1>
<a name="php-vfs" class="anchor" href="#php-vfs"><span class="octicon octicon-link"></span></a>php-vfs</h1>

<p>Very simple filesystem emulating PHP stream wrapper for use in unit testing
with PHPUnit, PHPSpec or any other testing framework. It offers means to test methods interacting
with real filesystem without creating temporary directories or file fixtures.</p>

<p>Released under a GPL3+ licence.</p>

<p>For latest release please use tag indicated above.</p>

<h2>
<a name="prerequisites" class="anchor" href="#prerequisites"><span class="octicon octicon-link"></span></a>Prerequisites</h2>

<p>PHP &gt;= 5.4.0</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p><strong>Composer</strong></p>

<p>Add a dev dependency on php-vfs/php-vfs to your project's composer.json</p>

<pre><code>{
    "require-dev": {
        "php-vfs/php-vfs": "*@stable"
    }
}
</code></pre>

<p>Or via command line:</p>

<pre><code>composer require --dev php-vfs/php-vfs=*@stable
</code></pre>

<p>This will install latest stable version of php-vfs as a development dependency, for the latest development version replace <a href="https://github.com/stable" class="user-mention">@stable</a> with <a href="https://github.com/dev" class="user-mention">@dev</a>.</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Let's assume we need to test a class that reads CSV file and provides SUM() of columns. The unit test class would normally look something similar to following:</p>

<div class="highlight highlight-PHP"><pre><span class="k">class</span> <span class="nc">CSVTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_sumIsCorrectlyCalculated</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$csv</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CSV</span><span class="p">(</span><span class="s1">'fixtures/sum.csv'</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nv">$csv</span><span class="o">-&gt;</span><span class="na">getColumnSum</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">'Sum of first column is 10'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="nv">$csv</span><span class="o">-&gt;</span><span class="na">getCOlumnSum</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s1">'Sum of first column is 15'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>And the CSV file would look something like:</p>

<pre><code>"Column 1","Column 2"
5,5
4,7
1,3
</code></pre>

<p>And our CSV class:</p>

<div class="highlight highlight-PHP"><pre><span class="k">class</span> <span class="nc">CSV</span> <span class="p">{</span>

    <span class="k">protected</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="p">(</span><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\RuntimeException</span><span class="p">(</span><span class="s1">'Could not read input file: '</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">while</span><span class="p">(</span><span class="k">false</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$data</span> <span class="o">=</span> <span class="nb">fgetcsv</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getColumnSum</span><span class="p">(</span><span class="nv">$column</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$toSum</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="k">as</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$toSum</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$line</span><span class="p">[</span><span class="nv">$column</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">array_sum</span><span class="p">(</span><span class="nv">$toSum</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>While above works, providing fixture file to be able to test is somewhat not in line with unit testing principles; it creates dependency on filesystem.
We could possibly create the file in our setUp method and then clear it in tearDown, but if the test fails and tearDown is never executed we will leave
 garbage behind, and we didn't even consider a situation when we don't have permissions to the file system and so on. The other option is to create fixture and keep
 it together with source files. While this approach is widely used it does mean that if someone changes that fixture your test will fail.</p>

<p>The solution is to create our file in memory - this is when php-vfs comes into play.</p>

<p>Let's consider slightly reworked unit test:</p>

<div class="highlight highlight-PHP"><pre><span class="k">use</span> <span class="nx">VirtualFileSystem\FileSystem</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CSVTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span> <span class="p">{</span>

    <span class="k">protected</span> <span class="nv">$csvData</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'"Column 1";"Column 2"'</span><span class="p">,</span>
        <span class="s1">'5,5'</span><span class="p">,</span>
        <span class="s1">'4,7'</span><span class="p">,</span>
        <span class="s1">'1,3'</span>
    <span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_sumIsCorrectlyCalculated</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="nv">$fs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileSystem</span><span class="p">();</span>

        <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$fs</span><span class="o">-&gt;</span><span class="na">path</span><span class="p">(</span><span class="s1">'/sum.csv'</span><span class="p">),</span> <span class="nb">join</span><span class="p">(</span><span class="nx">PHP_EOL</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">csvData</span><span class="p">));</span>

        <span class="nv">$csv</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CSV</span><span class="p">(</span><span class="nv">$fs</span><span class="o">-&gt;</span><span class="na">path</span><span class="p">(</span><span class="s1">'/sum.csv'</span><span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nv">$csv</span><span class="o">-&gt;</span><span class="na">getColumnSum</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">'Sum of first column is 10'</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="nv">$csv</span><span class="o">-&gt;</span><span class="na">getCOlumnSum</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s1">'Sum of first column is 15'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As you can see there is no fixture or file created by our test that could be otherwise left behind. We can control the file contents and existence within the
scope of our unit test, thus keeping our test background/environment isolated from external changes.</p>

<h2>
<a name="usage-1" class="anchor" href="#usage-1"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>While using low level API for interaction with php-vfs is at its core, a much easier approach is to mock filesystem using provided interface.</p>

<p>There are generally 2 methods you should always use when mocking up the state:</p>

<ul>
<li>
<code>\VirtualFileSystem\FileSystem::createDirectory($path, $recursive, $mode)</code> used to mock directory;</li>
<li>
<code>\VirtualFileSystem\FileSystem::createFIle($path, $data)</code> used to mock file and its contents.</li>
</ul><p>Combining above 2 should allow you to recreate any direcotry/file structure.</p>

<h2>
<a name="behaviour" class="anchor" href="#behaviour"><span class="octicon octicon-link"></span></a>Behaviour</h2>

<p>php-vfs tries to mimick unix filesystem as much as possible. The same conditions must be matched and the same errors will be triggered as if we were interacting via php with real underlying filesystem.</p>

<p>Most of <a href="http://www.php.net/manual/en/ref.filesystem.php">PHP filesystem functions</a> are happily supported by php-vfs as long as the full file URL is passed as argument (using <code>$fs-&gt;path()</code>). If you find something not working and not listed below please rise an issue on <a href="https://github.com/thornag/php-vfs/issues">github issues page</a></p>

<p><strong>Supported</strong></p>

<p>fopen modes
setting permissions and ownership
directory iteration
file access/modification/change times</p>

<p><strong>Currently unsupported</strong></p>

<p>permission/ownership checks</p>

<p><strong>Known pitfalls</strong></p>

<p>streamWrapper implementations like php-vfs will not work with glob methods for directory iteration - you need to use DirectoryIterator or readdir instead.</p>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Any contributions are more than welcome. Please make sure that you keep to PSR-2 standards and provide tested code.</p>

<p>You are more than welcome to add yourself to CONTRIBUTORS.md.</p>
        </section>

        <footer>
          PHP Virtual filesystem is maintained by <a href="https://github.com/thornag">thornag</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-45416100-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>
